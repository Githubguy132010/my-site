<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>GitHub Workflow Rewrite for Arch Linux without the beeps | Thomas Brugman</title>
<meta name="keywords" content="github-actions, ci-cd, arch-linux">
<meta name="description" content="The GitHub Workflow Rewrite
Today, I&rsquo;d like to share how we&rsquo;ve improved the GitHub Actions workflow for automatically building our Arch Linux ISO without system beeps. This workflow is a crucial component of our project, as it generates a fresh ISO with the latest updates daily.
Key Improvements


Robust Error Handling

Addition of comprehensive error checking
Improved logging for debugging
Timeout limit of 120 minutes to prevent hanging builds
Additional Details: The error handling now includes specific checks for common issues such as network failures and package conflicts, ensuring that the build process is more resilient.



Automated Release Notes">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/2024/arch-linux-without-the-beeps-gh-wf-overhaul/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.0b672cb5fe641444534c5779c10a3ca585a318c0f6e29db647ceca377db197aa.css" integrity="sha256-C2cstf5kFERTTFd5wQo8pYWjGMD24p22R87KN32xl6o=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/2024/arch-linux-without-the-beeps-gh-wf-overhaul/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="/css/background.css">


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const images = document.querySelectorAll('.post-content img, .entry-content img');
        images.forEach(img => {
            if (img.complete) {
                img.classList.add('loaded');
            } else {
                img.addEventListener('load', function() {
                    img.classList.add('loaded');
                });
            }
        });
    });
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Thomas Brugman (Alt + H)">Thomas Brugman</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/who-i-am/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/projects/" title="Projects">
                    <span>Projects</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      GitHub Workflow Rewrite for Arch Linux without the beeps
    </h1>
    <div class="post-meta"><span title='2024-12-23 00:00:00 +0000 UTC'>December 23, 2024</span>&nbsp;Â·&nbsp;6 min

</div>
  </header> 
  <div class="post-content"><h1 id="the-github-workflow-rewrite">The GitHub Workflow Rewrite<a hidden class="anchor" aria-hidden="true" href="#the-github-workflow-rewrite">#</a></h1>
<p>Today, I&rsquo;d like to share how we&rsquo;ve improved the GitHub Actions workflow for automatically building our Arch Linux ISO without system beeps. This workflow is a crucial component of our project, as it generates a fresh ISO with the latest updates daily.</p>
<h2 id="key-improvements">Key Improvements<a hidden class="anchor" aria-hidden="true" href="#key-improvements">#</a></h2>
<ol>
<li>
<p><strong>Robust Error Handling</strong></p>
<ul>
<li>Addition of comprehensive error checking</li>
<li>Improved logging for debugging</li>
<li>Timeout limit of 120 minutes to prevent hanging builds</li>
<li><strong>Additional Details</strong>: The error handling now includes specific checks for common issues such as network failures and package conflicts, ensuring that the build process is more resilient.</li>
</ul>
</li>
<li>
<p><strong>Automated Release Notes</strong></p>
<ul>
<li>Automatic generation of release notes</li>
<li>Including changelog since last release</li>
<li>Clear presentation of features and changes</li>
<li><strong>Additional Details</strong>: The release notes are now formatted in Markdown, making them easy to read and integrate into our documentation.</li>
</ul>
</li>
<li>
<p><strong>Security and Verification</strong></p>
<ul>
<li>Automatic generation of SHA256 and SHA512 checksums</li>
<li>Build process verification</li>
<li>Checks for successful ISO creation</li>
<li><strong>Additional Details</strong>: We have also implemented GPG signing for the ISOs, providing an additional layer of security and authenticity verification.</li>
</ul>
</li>
</ol>
<h2 id="technical-details">Technical Details<a hidden class="anchor" aria-hidden="true" href="#technical-details">#</a></h2>
<p>The workflow runs in a Docker container based on Arch Linux, ensuring a clean and isolated build environment. We use <code>archiso</code> for building the ISO.</p>
<p>The build process is divided into clear steps:</p>
<ol>
<li>Preparing the build environment</li>
<li>Caching Pacman packages</li>
<li>Building the ISO</li>
<li>Generating checksums</li>
<li>Creating a new release</li>
</ol>
<p>If you want to see the complete workflow, I will post a snippet of it here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build ISO</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">workflow_dispatch</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedule</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">cron</span>: <span style="color:#e6db74">&#39;0 0 * * *&#39;</span>  <span style="color:#75715e"># Run the workflow every day at midnight</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">main</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">paths-ignore</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;**.md&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;.gitignore&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">DOCKER_BUILDKIT</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ISO_FILENAME</span>: <span style="color:#ae81ff">Arch.iso</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeout-minutes</span>: <span style="color:#ae81ff">120</span>  <span style="color:#75715e"># Set a timeout to prevent hung builds</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout Repository</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Set up environment variables</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">env</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;DATE=$(date +&#39;%Y-%m-%d&#39;)&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;VERSION=$(date +&#39;%Y.%m.%d&#39;)&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;CACHE_KEY=$(date +&#39;%Y-%m&#39;)&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;WORKSPACE=${GITHUB_WORKSPACE}&#34; &gt;&gt; $GITHUB_ENV</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Create Cache Directories</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          sudo mkdir -p /tmp/pacman-cache
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          sudo chmod 777 /tmp/pacman-cache
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Ensure the directory is empty to prevent tar errors
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          sudo rm -rf /tmp/pacman-cache/*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Cache Pacman packages</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/cache@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/tmp/pacman-cache</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">pacman-${{ runner.os }}-${{ env.CACHE_KEY }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">restore-keys</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pacman-${{ runner.os }}-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Set up Arch Linux Container</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker run --privileged --name arch-container -d \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            -v ${{ env.WORKSPACE }}:/workdir \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            -v /tmp/pacman-cache:/var/cache/pacman/pkg \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            archlinux:latest sleep infinity</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Initialize Container</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker exec arch-container bash -c &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            set -euo pipefail
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # Update package database and system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pacman -Syu --noconfirm
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # Install required packages
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pacman -S --noconfirm --needed \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              git \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              archiso \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              grub \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              curl \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              jq \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              gnupg \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              make \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              sudo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # Verify installation
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            command -v mkarchiso &gt;/dev/null 2&gt;&amp;1 || {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;::error::mkarchiso not found&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build ISO</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker exec arch-container bash -c &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            set -euo pipefail
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            cd /workdir
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # Cleanup any previous builds
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            rm -rf workdir/ out/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            mkdir -p out/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # Build the ISO with verbose output
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            mkarchiso -v -w workdir/ -o out/ . 2&gt;&amp;1 | tee build.log || {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;::error::ISO build failed!&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              tail -n 50 build.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # Verify ISO was created
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            [ -f out/*.iso ] || {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;::error::ISO file not found after build&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Generate Checksums</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker exec arch-container bash -c &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            set -euo pipefail
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            cd /workdir/out
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # Generate checksums
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            for iso in *.iso; do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              sha256sum \&#34;\$iso\&#34; &gt; \&#34;\${iso}.sha256sum\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              sha512sum \&#34;\$iso\&#34; &gt; \&#34;\${iso}.sha512sum\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Rename and Move ISO</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker exec arch-container bash -c &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            set -euo pipefail
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            cd /workdir/out
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            for f in *.iso; do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              newname=\&#34;arch-linux-no-beeps-${{ env.VERSION }}.iso\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              mv \&#34;\$f\&#34; \&#34;\$newname\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              mv \&#34;\$f.sha256sum\&#34; \&#34;\$newname.sha256sum\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              mv \&#34;\$f.sha512sum\&#34; \&#34;\$newname.sha512sum\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Generate Release Notes</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">release_notes</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Create a temporary file for release notes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          TEMP_RELEASE_NOTES=$(mktemp)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker exec arch-container bash -c &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            set -euo pipefail
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            cd /workdir
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # Initialize release notes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;ðŸš€ Arch Linux ISO without system beeps (build ${{ env.DATE }})&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;### Changes&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              # Get changes since last release
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              if git tag | grep -q .; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                LAST_TAG=\$(git describe --tags --abbrev=0 2&gt;/dev/null || echo &#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                if [ ! -z \&#34;\$LAST_TAG\&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  echo &#39;#### Commits since last release:&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  git log \&#34;\$LAST_TAG\&#34;..HEAD --pretty=format:&#39;- %s&#39; | grep -v &#39;Merge&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  echo &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              # Add standard information
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;### Features&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;- Automatic daily build&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;- System beeps disabled&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;- ISO SHA256 and SHA512 checksums included&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;### Download&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;- Download the ISO and verify checksums before use&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;### Checksums&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#39;SHA256 and SHA512 checksums are available in the uploaded files.&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            } &gt; /tmp/release_notes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Copy release notes from container to host
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          docker cp arch-container:/tmp/release_notes $TEMP_RELEASE_NOTES
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Set the release notes in GITHUB_ENV
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#39;RELEASE_NOTES&lt;&lt;EOF&#39; &gt;&gt; $GITHUB_ENV
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          cat $TEMP_RELEASE_NOTES &gt;&gt; $GITHUB_ENV
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#39;EOF&#39; &gt;&gt; $GITHUB_ENV
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          # Cleanup
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          rm -f $TEMP_RELEASE_NOTES</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Create Release</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">create_release</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">softprops/action-gh-release@v1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">if</span>: <span style="color:#ae81ff">github.ref == &#39;refs/heads/main&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">tag_name</span>: <span style="color:#ae81ff">v${{ env.VERSION }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;Arch Linux No Beeps v${{ env.VERSION }}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">body</span>: <span style="color:#ae81ff">${{ env.RELEASE_NOTES }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">draft</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">prerelease</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">files</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ${{ env.WORKSPACE }}/out/*.iso
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ${{ env.WORKSPACE }}/out/*.sha*sum</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Clean Up</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">if</span>: <span style="color:#ae81ff">always()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          if docker ps -a | grep -q arch-container; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            docker stop arch-container || true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            docker rm -f arch-container || true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          sudo rm -rf workdir/ out/ /tmp/pacman-cache/*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Upload Build Logs on Failure</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">if</span>: <span style="color:#ae81ff">failure()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/upload-artifact@v4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">build-logs</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ${{ env.WORKSPACE }}/build.log</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">retention-days</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">compression-level</span>: <span style="color:#ae81ff">9</span>  <span style="color:#75715e"># Maximum compression for logs</span>
</span></span></code></pre></div><p><strong>Additional Technical Insights</strong>: The Docker container is configured to use the latest Arch Linux base image, ensuring that we always build with the most up-to-date packages. We have also optimized the Dockerfile to minimize the image size and build time.</p>
<h2 id="future-improvements">Future Improvements<a hidden class="anchor" aria-hidden="true" href="#future-improvements">#</a></h2>
<p>Looking ahead, I plan to integrate more advanced features such as:</p>
<ul>
<li><strong>Parallel Builds</strong>: To further reduce build times, I am exploring the possibility of running multiple build processes in parallel.</li>
<li><strong>Automated Testing</strong>: Implementing automated tests for the ISO to ensure that it functions correctly on a variety of hardware configurations.</li>
<li><strong>User Feedback Integration</strong>: Gathering feedback from users to continuously improve the build process and address any issues they encounter.</li>
</ul>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>This rewrite has resulted in a more reliable and efficient workflow. The daily builds are now faster and produce consistent results. The improved error handling and logging make it easier to identify and resolve any issues that may arise.</p>
<p>For those interested in the details: the complete workflow configuration can be found in our <a href="https://github.com/thomasbrugman/Arch-Linux-without-the-beeps">GitHub repository</a>.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/github-actions/">Github-Actions</a></li>
      <li><a href="http://localhost:1313/tags/ci-cd/">Ci-Cd</a></li>
      <li><a href="http://localhost:1313/tags/arch-linux/">Arch-Linux</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Thomas Brugman</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
